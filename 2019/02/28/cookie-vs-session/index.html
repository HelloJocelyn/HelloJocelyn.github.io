<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Joeclyn's personal blog"><title>cookie-vs-session | Jocelyn's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">cookie-vs-session</h1><a id="logo" href="/.">Jocelyn's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">cookie-vs-session</h1><div class="post-meta">Feb 28, 2019<span> | </span><span class="category"><a href="/categories/http/">http</a></span></div><div class="post-content"><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><h3 id="概念：用来（长时间存储数据）存储数据。"><a href="#概念：用来（长时间存储数据）存储数据。" class="headerlink" title="概念：用来（长时间存储数据）存储数据。"></a>概念：用来（长时间存储数据）存储数据。</h3><ol>
<li>cookie存储以域名方式分隔；</li>
<li>cookie数据可以设置名字，值，域名，path,过期时间，大小等</li>
<li>同一个域名下cookie个数有限。不同浏览器个数限制不同。Firefox为50个，Safari/Webkit貌似没有限制。</li>
<li>单个cookie保存的数据大小不能超过4K。</li>
<li>每种浏览器cookie存储文件地址不一样。chrome地址为%LOCALAPPDATA%/Google/Chrome/User Data/Default/下的Cookie文件。<h3 id="cookie属性详解："><a href="#cookie属性详解：" class="headerlink" title="cookie属性详解："></a>cookie属性详解：</h3></li>
</ol>
<ul>
<li>Name:</li>
<li>Value:</li>
<li>Domain: 域，表示当前cookie所属于哪个域或子域下面。对于服务器返回的Set-Cookie中，如果没有指定Domain的值，那么其Domain的值是默认为当前所提交的http的请求所对应的主域名的。比如访问 <code>http://www.example.com</code>，返回一个cookie，没有指名domain值，那么其为值为默认的<code>www.example.com</code>。</li>
<li>Path: 表示cookie的所属路径</li>
<li>Expires/Max-Age: 表示了cookie的有效期。expire的值，是一个时间，过了这个时间，该cookie就失效了。或者是用max-age指定当前cookie是在多长时间之后而失效。如果服务器返回的一个cookie，没有指定其expire time，那么表明此cookie有效期只是当前的session，即是session cookie，当前session会话结束后，就过期了。对应的，当关闭（浏览器中）该页面的时候，此cookie就应该被浏览器所删除了。</li>
<li>Size: 大小</li>
<li>HTTP: 表示此cookie必须用于http或https传输。这意味着，浏览器脚本，比如javascript中，是不允许访问操作此cookie的。</li>
<li>Secure: 表示该cookie只能用https传输。一般用于包含认证信息的cookie，要求传输此cookie的时候，必须用https传输。</li>
<li>SameSite: 两个值：Strict（严格的）和Lax（宽松的）。当为严格模式时，表明禁止第三方模式。比如如果天猫页面设置为Strict后，从天猫页面访问淘宝则不是登录状态。</li>
</ul>
<h3 id="Cookie的缺陷"><a href="#Cookie的缺陷" class="headerlink" title="Cookie的缺陷"></a>Cookie的缺陷</h3><ul>
<li>cookie会被附加在每个HTTP请求中，所以无形中增加了流量。</li>
<li>由于在HTTP请求中的cookie是明文传递的，所以安全性成问题。（除非用HTTPS)</li>
<li>Cookie的大小限制在4KB左右。对于复杂的存储需求来说是不够用的。<h3 id="cookie存储"><a href="#cookie存储" class="headerlink" title="cookie存储"></a>cookie存储</h3>每种浏览器cookie存储文件地址不一样。chrome地址为%LOCALAPPDATA%/Google/Chrome/User Data/Default/下的Cookie文件。<br>打开chrome的Cookie文件，看到是sqllite的数据库文件，使用sqllite database browser打开该数据库文件。可以看到下面数据。</li>
</ul>
<p>图一：谷歌浏览器查看<br><img src="../pics/cookie-chrome-storage.png" alt="cookie-chrome-storage"><br>图二：sqlite database browser查看<br><img src="../pics/cookie-chrome-sqlite.png" alt="cookie-chrome-sqlite"></p>
<p>可以看到value数据为空，但是多了个encrypted_value. 浏览器会把比较重要的信息例如自动登录的账号密码以及各种 token 等信息加密存放到此字段中，在发送请求的时候浏览器会将此字段解密，作为请求发给服务器.(然而这个很容易就被人破解，唉)</p>
<h3 id="后端实现"><a href="#后端实现" class="headerlink" title="后端实现"></a>后端实现</h3><p>增加请求头“Set-Cookie”的方式。<br>发到浏览器端后，浏览器自动识别set-cookie并存储。</p>
<h3 id="前端实现"><a href="#前端实现" class="headerlink" title="前端实现"></a>前端实现</h3><ol>
<li>前端不能直接操作set-cookie</li>
</ol>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>session机制是一种服务器端的机制，服务器使用一种类似于散列表的结构（也可能就是使用散列表）来保存信息。<br>客户端初次请求服务端，服务端会为客户端创建一个session，并将该sessionId存入客户端cookie中。下次访问可凭此sessionId来获取session。当cookie被禁止时，也可以将sessionId附在url中，或者通过隐式表单实现。<br>因为session存储在服务器，所以只能服务器才会删除session数据。而浏览器是不会通知服务器去删除的。那么我们通常说的“只要关闭浏览器，session就消失了“又是什么情况呢。这个其实是因为关闭浏览器，存储sessionId的cookie会被删除。则自然无法在服务器上找到对应的session。</p>
<h3 id="session的作用"><a href="#session的作用" class="headerlink" title="session的作用"></a>session的作用</h3><h3 id="session的后台实现"><a href="#session的后台实现" class="headerlink" title="session的后台实现"></a>session的后台实现</h3><h3 id="session在服务器间传递"><a href="#session在服务器间传递" class="headerlink" title="session在服务器间传递"></a>session在服务器间传递</h3><p>webstorage<br>    localStorage<br>    sessionStorage</p>
<h2 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h2><h2 id="服务间共享"><a href="#服务间共享" class="headerlink" title="服务间共享"></a>服务间共享</h2></div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2019/03/05/shortcuts-of-different-tools/">shortcuts_of_different_tools</a><a class="next" href="/2019/02/27/software-security/">software-security</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://hellojocelyn.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software/">software</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/03/12/spring-security/">spring-security</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/06/architector/">architector</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/05/shortcuts-of-different-tools/">shortcuts_of_different_tools</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/28/cookie-vs-session/">cookie-vs-session</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/27/software-security/">software-security</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/27/daily-steps/">daily_steps</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/22/spring-HATEOAS/">spring-HATEOAS</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/21/learning-website/">learning-website</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/21/database-design/">database-design</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/21/Q-tips/">Q-tips</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Jocelyn's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>